---
import { Image } from "astro:assets";
import type { Image as ImageType } from "@/schema";
import {
  Carousel as PreactCarousel,
  CarouselItem,
} from "@/components/preact/Carousel";
interface Props {
  images: ImageType[];
  limit?: number;
  class?: string;
  transitionName?: string;
  imagesLayout?: "constrained" | "full-width" | "fixed" | "none";
  isLazyLoaded?: boolean;
}

let {
  images,
  limit,
  imagesLayout,
  isLazyLoaded,
  transitionName,
  class: className,
  ...other
} = Astro.props;
if (limit !== undefined) {
  images = images.slice(0, limit);
}
---

<PreactCarousel
  {...other}
  client:load
  count={images.length}
  class={`${className} transition-carousel`}
>
  {
    images.map((image, i) => (
      <CarouselItem>
        <Image
          {...image}
          loading={isLazyLoaded || i !== 0 ? "lazy" : "eager"}
          layout={imagesLayout ?? "full-width"}
          {...other}
        />
      </CarouselItem>
    ))
  }
</PreactCarousel>
<style define:vars={{ transitionName }}>
  :global(astro-slot) {
      display: contents;
  }
  .transition-carousel {
    view-transition-name: var(--transitionName);
  }
</style>
